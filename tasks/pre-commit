#!/usr/bin/env bash

set -e

STAGED_FILES=$(git diff --name-only --staged --diff-filter=d)
STAGED_README=$(echo $STAGED_FILES | tr " " "\n" | grep -i "readme")
STAGED_DRAWIO=$(echo $STAGED_FILES | tr " " "\n" | grep -i ".drawio$")

if [ ! -z "$STAGED_FILES" ]; then
    ./tasks/lint
    ./tasks/cov-check
fi

if [ ! -z "$STAGED_README" ]; then
    ./tasks/readme-gen
fi

if [ ! -z "$STAGED_DRAWIO" ]; then
    echo $STAGED_DRAWIO | xargs -n1 ./tasks/drawio-gen
fi
